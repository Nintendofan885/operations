#!/bin/sh
#   -------------------------------------------------------------
#   Quassel change password wrapper
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
#   Project:        Eglide
#   Created:        2018-03-28
#   License:        Trivial work, not eligible to copyright
#   Source file:    roles/shellserver/quassel-core/files/chquasselpasswd.sh
#   -------------------------------------------------------------
#
#   <auto-generated>
#       This file is managed by our rOPS SaltStack repository.
#
#       Changes to this file may cause incorrect behavior
#       and will be lost if the state is redeployed.
#   </auto-generated>

#   -------------------------------------------------------------
#   Configuration
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

QUASSEL_CONFIG_DIR=/var/lib/quassel
QUASSEL_USER="{{ quassel.user }}"

#   -------------------------------------------------------------
#   Helper methods
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

error() {
    echo "$@" 1>&2;
}

getcommandname() {
    basename "$0"
}

usage() {
    echo "Usage: $(getcommandname)"
    echo "       Change the Quassel user password"
    exit 64
}

#   -------------------------------------------------------------
#   Check arguments
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

if [ "$1" = "-h" ] || [ "$1" = "--help" ]; then
    usage
elif [ $# -gt 0 ]; then
    error "$(getcommandname): illegal option -- $*"
    usage
fi

#   -------------------------------------------------------------
#   Call quassel core
#   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

sudo -u "$QUASSEL_USER" \
    quasselcore --configdir="$QUASSEL_CONFIG_DIR" --change-userpass="$USER"
